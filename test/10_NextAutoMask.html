<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><title>自動選択ツール</title><style>#canvasContainer{position:relative}#imageCanvas,#overlayCanvas{border:1px solid #000;position:absolute;top:0;left:0}</style></head><body><input type="file" id="imageLoader" name="imageLoader"><br>トレランス: <input type="range" id="toleranceSlider" min="0" max="100" value="50"> <span id="toleranceValue">50</span><br><br><button id="saveMask">マスク画像を保存</button> <button id="clearMask">マスク画像を削除</button> <button id="toggleSmoothing">平滑化: オフ</button> <button id="toggleBlurring">境界ぼかし: オフ</button><div id="canvasContainer"><canvas id="imageCanvas" width="500" height="500"></canvas><canvas id="overlayCanvas" width="500" height="500"></canvas></div><script>document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("imageCanvas"),e=document.getElementById("overlayCanvas"),n=t.getContext("2d"),a=e.getContext("2d"),c=document.getElementById("imageLoader"),d=document.getElementById("toleranceSlider"),o=document.getElementById("toleranceValue"),i=document.getElementById("saveMask"),r=document.getElementById("clearMask"),l=document.getElementById("toggleSmoothing"),h=document.getElementById("toggleBlurring");let s;const g=new Set;let u=!1,m=!1;function f(t,e,n){const a=4*(n*t.width+e);return{r:t.data[a],g:t.data[a+1],b:t.data[a+2],a:t.data[a+3]}}function w(t,e,n){t/=255,e/=255,n/=255;const a=Math.max(t,e,n),c=Math.min(t,e,n);let d,o,i=a;const r=a-c;if(o=0===a?0:r/a,a===c)d=0;else{switch(a){case t:d=(e-n)/r+(e<n?6:0);break;case e:d=(n-t)/r+2;break;case n:d=(t-e)/r+4}d/=6}return[d,o,i]}function E(t,e,n){const[a,c,d]=w(t.r,t.g,t.b),[o,i,r]=w(e.r,e.g,e.b);return Math.abs(a-o)<=n/360&&Math.abs(c-i)<=n/100&&Math.abs(d-r)<=n/100}c.addEventListener("change",(function(a){const c=new FileReader;c.onload=function(a){const c=new Image;c.onload=function(){t.width=c.width,t.height=c.height,e.width=c.width,e.height=c.height,n.drawImage(c,0,0),s=n.getImageData(0,0,t.width,t.height)},c.src=a.target.result},c.readAsDataURL(a.target.files[0])}),!1),d.addEventListener("input",(function(){o.textContent=d.value})),l.addEventListener("click",(function(){u=!u,l.textContent="平滑化: "+(u?"オン":"オフ")})),h.addEventListener("click",(function(){m=!m,h.textContent="境界ぼかし: "+(m?"オン":"オフ")})),e.addEventListener("click",(function(t){const n=t.offsetX,c=t.offsetY;if(!s)return;const o=f(s,n,c),i=parseInt(d.value,10),r=function(t,e,n,a,c){const d=[[e,n]],o=[],i=new Set;for(;d.length>0;){const[e,n]=d.pop(),r=`${e},${n}`;if(i.has(r)||g.has(r))continue;i.add(r);E(f(t,e,n),a,c)&&(o.push(r),d.push([e+1,n]),d.push([e-1,n]),d.push([e,n+1]),d.push([e,n-1]))}return o}(s,n,c,o,i);r.forEach((t=>g.add(t))),function(t,e){e.forEach((e=>{const[n,a]=e.split(",").map(Number);t.clearRect(n,a,1,1),t.fillStyle="rgba(255, 0, 0, 0.5)",t.fillRect(n,a,1,1)}))}(a,r),u&&function(t,e){const n=document.createElement("canvas");n.width=e.width,n.height=e.height;n.getContext("2d").drawImage(e,0,0),t.clearRect(0,0,e.width,e.height),t.filter="blur(2px)",t.drawImage(n,0,0),t.filter="none"}(a,e),m&&function(t,e){const n=document.createElement("canvas");n.width=e.width,n.height=e.height;n.getContext("2d").drawImage(e,0,0),t.clearRect(0,0,e.width,e.height),t.filter="blur(4px)",t.drawImage(n,0,0),t.filter="none"}(a,e)})),i.addEventListener("click",(()=>{const t=e.toDataURL("image/png"),n=document.createElement("a");n.href=t,n.download="mask.png",n.click()})),r.addEventListener("click",(()=>{a.clearRect(0,0,e.width,e.height),g.clear()}))}))</script></body></html>