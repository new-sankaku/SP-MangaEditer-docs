<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>拡張版方向性ブラー付き楕円形雪のトーン生成器</title><script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script><style>body{background-color:#333;display:flex;flex-direction:column;align-items:center;padding:20px;font-family:Arial,sans-serif;color:#fff}canvas{border:1px solid #ccc;margin-bottom:20px}#controls{margin-bottom:20px;display:grid;grid-template-columns:auto auto;gap:10px}input,label{margin-right:10px}button{margin-top:10px}</style></head><body><h1>拡張版方向性ブラー付き楕円形雪のトーン生成器</h1><div id="controls"><label for="snowDensity">雪の密度:</label> <input type="range" id="snowDensity" min="50" max="500" value="200"> <label for="frontSnowSize">手前の雪サイズ:</label> <input type="range" id="frontSnowSize" min="5" max="20" value="10"> <label for="backSnowSize">奥の雪サイズ:</label> <input type="range" id="backSnowSize" min="1" max="10" value="3"> <label for="frontBlurLength">手前のブラーの長さ:</label> <input type="range" id="frontBlurLength" min="0" max="50" value="20"> <label for="backBlurLength">奥のブラーの長さ:</label> <input type="range" id="backBlurLength" min="0" max="25" value="5"> <label for="frontColor">手前の雪の色:</label> <input type="color" id="frontColor" value="#FFFFFF"> <label for="backColor">奥の雪の色:</label> <input type="color" id="backColor" value="#CCCCCC"> <label for="snowAngle">雪の角度 (度):</label> <input type="range" id="snowAngle" min="0" max="180" value="90"> <button id="generate">生成</button> <button id="downloadPng">PNGダウンロード</button></div><canvas id="canvas" width="500" height="500"></canvas><canvas id="lowerCanvas" width="500" height="500"></canvas><script>const canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),lowerCanvas=new fabric.Canvas("lowerCanvas"),snowDensity=document.getElementById("snowDensity"),frontSnowSize=document.getElementById("frontSnowSize"),backSnowSize=document.getElementById("backSnowSize"),frontBlurLength=document.getElementById("frontBlurLength"),backBlurLength=document.getElementById("backBlurLength"),frontColor=document.getElementById("frontColor"),backColor=document.getElementById("backColor"),snowAngle=document.getElementById("snowAngle"),generateBtn=document.getElementById("generate"),downloadPngBtn=document.getElementById("downloadPng");function drawSnowflake(e,t,n,a,o,r){ctx.save(),ctx.translate(e,t),ctx.rotate(r*Math.PI/180);const l=ctx.createLinearGradient(0,-n/2-a,0,n/2+a);l.addColorStop(0,"rgba(255,255,255,0)"),l.addColorStop(.5-n/(4*a),"rgba(255,255,255,0)"),l.addColorStop(.5,o),l.addColorStop(.5+n/(4*a),"rgba(255,255,255,0)"),l.addColorStop(1,"rgba(255,255,255,0)"),ctx.beginPath(),ctx.ellipse(0,0,n/4,n/2+a,0,0,2*Math.PI),ctx.fillStyle=l,ctx.fill(),ctx.restore()}function interpolateColor(e,t,n){const a=parseInt(e.substr(1,2),16),o=parseInt(e.substr(3,2),16),r=parseInt(e.substr(5,2),16),l=parseInt(t.substr(1,2),16),d=parseInt(t.substr(3,2),16),c=parseInt(t.substr(5,2),16);return`rgb(${Math.round(a+n*(l-a))}, ${Math.round(o+n*(d-o))}, ${Math.round(r+n*(c-r))})`}function generateSnowTone(){ctx.fillStyle="black",ctx.fillRect(0,0,canvas.width,canvas.height);const e=parseInt(snowDensity.value),t=parseInt(frontSnowSize.value),n=parseInt(backSnowSize.value),a=parseInt(frontBlurLength.value),o=parseInt(backBlurLength.value),r=parseInt(snowAngle.value);for(let l=0;l<e;l++){const e=Math.random()*canvas.width,l=Math.random()*canvas.height,d=Math.random();drawSnowflake(e,l,n+(t-n)*d,o+(a-o)*d,interpolateColor(backColor.value,frontColor.value,d),r)}updateLowerCanvas()}function updateLowerCanvas(){lowerCanvas.clear();const e=canvas.toDataURL({format:"png"});fabric.Image.fromURL(e,(function(e){e.scaleToWidth(lowerCanvas.width),lowerCanvas.add(e);const t=new fabric.Rect({left:50,top:50,width:200,height:100,fill:"transparent",stroke:"white",strokeWidth:2,selectable:!0});lowerCanvas.add(t),lowerCanvas.renderAll(),t.on("selected",(function(){const e=t.height/t.width;canvas.height=canvas.width*e,lowerCanvas.setHeight(lowerCanvas.width*e),generateSnowTone()}))}))}function downloadPNG(){const e=document.createElement("a");e.href=canvas.toDataURL("image/png"),e.download="snow_tone.png",document.body.appendChild(e),e.click(),document.body.removeChild(e)}generateBtn.addEventListener("click",generateSnowTone),downloadPngBtn.addEventListener("click",downloadPNG),generateSnowTone()</script></body></html>