<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>拡張版自動スピードライン生成ツール（tempCanvas使用版）</title><script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script><style>body{font-family:sans-serif;text-align:center}canvas{border:1px solid #000;margin:10px 0}#controls,#options{margin:10px 0}.option-group{display:inline-block;margin:0 10px}</style></head><body><h1>拡張版自動スピードライン生成ツール（tempCanvas使用版）</h1><div id="controls"><button id="horizontal">水平線</button> <button id="vertical">垂直線</button> <button id="diagonal">斜め線</button> <button id="cross">十字線</button> <button id="clear">クリア</button> <button id="downloadSvg">SVGダウンロード</button></div><div id="options"><div class="option-group"><label for="density">密度: <span id="densityValue">50</span></label> <input type="range" id="density" min="1" max="200" value="50"></div><div class="option-group"><label for="angle">角度: <span id="angleValue">0</span>°</label> <input type="range" id="angle" min="0" max="359" value="0"></div><div class="option-group"><label for="gradientStart">グラデーション開始: <span id="gradientStartValue">0</span>%</label> <input type="range" id="gradientStart" min="0" max="100" value="0"></div><div class="option-group"><label for="gradientEnd">グラデーション終了: <span id="gradientEndValue">100</span>%</label> <input type="range" id="gradientEnd" min="0" max="100" value="100"></div><div class="option-group"><label for="lineColor">線の色:</label> <input type="color" id="lineColor" value="#000000"></div><div class="option-group"><label for="gradientToggle">グラデーション:</label> <input type="checkbox" id="gradientToggle" checked="checked"></div></div><canvas id="fabricCanvas" width="600" height="400"></canvas><script>const tempCanvas=document.createElement("canvas");tempCanvas.width=600,tempCanvas.height=400;const tempCtx=tempCanvas.getContext("2d"),fabricCanvas=new fabric.Canvas("fabricCanvas");let currentType="horizontal";function updateValue(e){const t=document.getElementById(e),a=document.getElementById(e+"Value");a&&(a.textContent=t.value)}function drawLine(e,t,a){const n=document.getElementById("gradientToggle").checked,d=document.getElementById("lineColor").value,i=parseInt(document.getElementById("gradientStart").value)/100,r=parseInt(document.getElementById("gradientEnd").value)/100;if(n){const a=tempCtx.createLinearGradient(e.x,e.y,t.x,t.y);a.addColorStop(0,`${d}${Math.round(255*i).toString(16).padStart(2,"0")}`),a.addColorStop(1,`${d}${Math.round(255*r).toString(16).padStart(2,"0")}`),tempCtx.strokeStyle=a}else tempCtx.strokeStyle=d,tempCtx.globalAlpha=a.opacity||1;tempCtx.lineWidth=a.strokeWidth||1,tempCtx.beginPath(),tempCtx.moveTo(e.x,e.y),tempCtx.lineTo(t.x,t.y),tempCtx.stroke()}function drawSpeedlines(e){tempCtx.clearRect(0,0,tempCanvas.width,tempCanvas.height);const t=parseInt(document.getElementById("density").value),a=parseInt(document.getElementById("angle").value)*Math.PI/180,n=tempCanvas.width,d=tempCanvas.height;for(let i=0;i<t;i++){let r,o;switch(e){case"horizontal":r={x:0,y:i*d/t},o={x:n,y:i*d/t};break;case"vertical":r={x:i*n/t,y:0},o={x:i*n/t,y:d};break;case"diagonal":r={x:0,y:i*d/(t-1)},o={x:n,y:i*d/(t-1)};break;case"cross":i<t/2?(r={x:0,y:i*d/(t/2)},o={x:n,y:i*d/(t/2)}):(r={x:(i-t/2)*n/(t/2),y:0},o={x:(i-t/2)*n/(t/2),y:d})}const c=o.x-r.x,s=o.y-r.y;drawLine(r,{x:r.x+c*Math.cos(a)-s*Math.sin(a),y:r.y+c*Math.sin(a)+s*Math.cos(a)},{opacity:1,strokeWidth:1})}updateFabricCanvas()}function updateDrawing(){drawSpeedlines(currentType)}function convertToSVG(){return`\n            <svg xmlns="http://www.w3.org/2000/svg" width="${tempCanvas.width}" height="${tempCanvas.height}">\n                <image href="${tempCanvas.toDataURL("image/png")}" width="${tempCanvas.width}" height="${tempCanvas.height}"/>\n            </svg>`}function downloadSVG(){const e=convertToSVG(),t=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download="speedlines.svg",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function updateFabricCanvas(){fabricCanvas.clear(),fabric.Image.fromURL(tempCanvas.toDataURL(),(function(e){e.scaleToWidth(fabricCanvas.width),fabricCanvas.add(e),fabricCanvas.renderAll()}));const e=new fabric.Rect({left:50,top:50,width:200,height:100,fill:"transparent",stroke:"black",strokeWidth:2,selectable:!0});fabricCanvas.add(e),fabricCanvas.renderAll(),e.on("selected",(function(){const t=e.height/e.width;tempCanvas.height=tempCanvas.width*t,fabricCanvas.setHeight(fabricCanvas.width*t),drawSpeedlines(currentType)}))}document.querySelectorAll("button").forEach((e=>{e.addEventListener("click",(()=>{"clear"===e.id?(tempCtx.clearRect(0,0,tempCanvas.width,tempCanvas.height),updateFabricCanvas()):"downloadSvg"===e.id?downloadSVG():(currentType=e.id,drawSpeedlines(currentType))}))})),["density","angle","gradientStart","gradientEnd","lineColor"].forEach((e=>{document.getElementById(e).addEventListener("input",(()=>{updateValue(e),updateDrawing()}))})),document.getElementById("gradientToggle").addEventListener("change",updateDrawing),updateDrawing()</script></body></html>