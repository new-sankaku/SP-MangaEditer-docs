<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>高機能漫画トーンジェネレーター（エラー処理強化版）</title><script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script><style>body{font-family:Arial,sans-serif;display:flex;flex-direction:column;align-items:center;padding:20px}#controls{margin-bottom:20px;display:flex;flex-wrap:wrap;justify-content:center;gap:20px}.control-group{display:flex;flex-direction:column;align-items:flex-start}label{margin-right:10px}input,select{margin-bottom:10px}.canvas-container{border:1px solid #ccc;margin-bottom:20px}.value-display{font-size:.9em;color:#666}</style></head><body><h1>高機能漫画トーンジェネレーター（エラー処理強化版）</h1><div id="controls"><div class="control-group"><label for="dotSize">ドットサイズ: <span id="dotSizeValue" class="value-display">10</span></label> <input type="range" id="dotSize" min="1" max="50" value="10"></div><div class="control-group"><label for="dotSpacing">ドット間隔: <span id="dotSpacingValue" class="value-display">5</span></label> <input type="range" id="dotSpacing" min="1" max="100" value="5"></div><div class="control-group"><label for="dotShape">ドット形状:</label> <select id="dotShape"><option value="circle">円形</option><option value="square">四角形</option><option value="triangle">三角形</option></select></div><div class="control-group"><label for="fillColor">塗りつぶし色:</label> <input type="color" id="fillColor" value="#000000"></div><div class="control-group"><label for="gradientEnabled">グラデーション:</label> <input type="checkbox" id="gradientEnabled" checked="checked"></div><div class="control-group"><label for="gradientDirection">グラデーション方向:</label> <select id="gradientDirection"><option value="top-bottom">上から下</option><option value="bottom-top">下から上</option><option value="left-right">左から右</option><option value="right-left">右から左</option></select></div><div class="control-group"><label for="gradientStart">グラデーション開始位置 (%):</label> <input type="number" id="gradientStart" min="0" max="100" value="0"></div><div class="control-group"><label for="gradientEnd">グラデーション終了位置 (%):</label> <input type="number" id="gradientEnd" min="0" max="100" value="100"></div><button id="downloadSvg">SVGダウンロード</button></div><div class="canvas-container"><canvas id="fabricCanvas" width="500" height="500"></canvas></div><script>const tempCanvas=document.createElement("canvas");tempCanvas.width=500,tempCanvas.height=500;const tempCtx=tempCanvas.getContext("2d"),fabricCanvas=new fabric.Canvas("fabricCanvas"),controlElements={dotSize:document.getElementById("dotSize"),dotSpacing:document.getElementById("dotSpacing"),dotShape:document.getElementById("dotShape"),fillColor:document.getElementById("fillColor"),gradientEnabled:document.getElementById("gradientEnabled"),gradientDirection:document.getElementById("gradientDirection"),gradientStart:document.getElementById("gradientStart"),gradientEnd:document.getElementById("gradientEnd"),downloadSvg:document.getElementById("downloadSvg"),dotSizeValue:document.getElementById("dotSizeValue"),dotSpacingValue:document.getElementById("dotSpacingValue")};function updateValueDisplay(){controlElements.dotSizeValue&&controlElements.dotSize&&(controlElements.dotSizeValue.textContent=controlElements.dotSize.value),controlElements.dotSpacingValue&&controlElements.dotSpacing&&(controlElements.dotSpacingValue.textContent=controlElements.dotSpacing.value)}function createShape(e,t,n,a,o,l){const c=`rgba(${parseInt(o.substr(1,2),16)}, ${parseInt(o.substr(3,2),16)}, ${parseInt(o.substr(5,2),16)}, ${l})`;switch(tempCtx.fillStyle=c,tempCtx.beginPath(),a){case"circle":tempCtx.arc(e,t,n/2,0,2*Math.PI);break;case"square":tempCtx.rect(e-n/2,t-n/2,n,n);break;case"triangle":tempCtx.moveTo(e,t-n/2),tempCtx.lineTo(e+n/2,t+n/2),tempCtx.lineTo(e-n/2,t+n/2)}tempCtx.fill()}function generateTone(){tempCtx.clearRect(0,0,tempCanvas.width,tempCanvas.height);const e=parseInt(controlElements.dotSize.value),t=parseInt(controlElements.dotSpacing.value),n=controlElements.dotShape.value,a=controlElements.fillColor.value,o=controlElements.gradientEnabled.checked,l=controlElements.gradientDirection.value,c=parseInt(controlElements.gradientStart.value)/100,d=parseInt(controlElements.gradientEnd.value)/100,i=500,r=e+t;for(let t=0;t<i+r;t+=r)for(let s=0;s<i+r;s+=r){let r=1;if(o){let e;switch(l){case"top-bottom":e=t/i;break;case"bottom-top":e=1-t/i;break;case"left-right":e=s/i;break;case"right-left":e=1-s/i}r=(e-c)/(d-c),r=Math.max(0,Math.min(1,r))}createShape(s,t,e,n,a,r)}updateFabricCanvas()}function updateFabricCanvas(){fabricCanvas.clear(),fabric.Image.fromURL(tempCanvas.toDataURL(),(function(e){e.scaleToWidth(fabricCanvas.width),fabricCanvas.add(e);const t=new fabric.Rect({left:50,top:50,width:200,height:100,fill:"transparent",stroke:"black",strokeWidth:2,selectable:!0});fabricCanvas.add(t),fabricCanvas.renderAll(),t.on("selected",(function(){const e=t.height/t.width;tempCanvas.height=tempCanvas.width*e,fabricCanvas.setHeight(fabricCanvas.width*e),generateTone()}))}))}function downloadSVG(){const e=`\n            <svg xmlns="http://www.w3.org/2000/svg" width="${tempCanvas.width}" height="${tempCanvas.height}">\n                <image href="${tempCanvas.toDataURL("image/png")}" width="${tempCanvas.width}" height="${tempCanvas.height}"/>\n            </svg>`,t=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download="manga_tone.svg",document.body.appendChild(a),a.click(),document.body.removeChild(a)}function debounce(e,t){let n;return function(...a){clearTimeout(n),n=setTimeout((()=>{clearTimeout(n),e(...a)}),t)}}const debouncedGenerateTone=debounce(generateTone,300);Object.keys(controlElements).forEach((e=>{const t=controlElements[e];t&&t!==controlElements.downloadSvg&&t.addEventListener("input",(()=>{updateValueDisplay(),debouncedGenerateTone()}))})),controlElements.downloadSvg&&controlElements.downloadSvg.addEventListener("click",downloadSVG),generateTone(),updateValueDisplay()</script></body></html>