<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>改善版ノイズグラデーション漫画トーン生成器（PNG対応）</title><script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script><style>body{font-family:sans-serif;margin:20px}canvas{border:1px solid #ccc;margin-bottom:20px}.controls{margin-top:10px}.control{margin-bottom:5px}label{display:inline-block;width:180px}button{margin-top:10px;margin-right:10px}</style></head><body><div class="controls"><div class="control"><label for="colorPicker">色:</label> <input type="color" id="colorPicker" value="#000000"></div><div class="control"><label for="noiseMinSlider">ノイズ最小量:</label> <input type="range" id="noiseMinSlider" min="0" max="100" value="0"></div><div class="control"><label for="noiseMaxSlider">ノイズ最大量:</label> <input type="range" id="noiseMaxSlider" min="0" max="100" value="100"></div><div class="control"><label for="gradientStartX">グラデーション開始 X:</label> <input type="range" id="gradientStartX" min="0" max="400" value="0"></div><div class="control"><label for="gradientStartY">グラデーション開始 Y:</label> <input type="range" id="gradientStartY" min="0" max="400" value="0"></div><div class="control"><label for="gradientEndX">グラデーション終了 X:</label> <input type="range" id="gradientEndX" min="0" max="400" value="400"></div><div class="control"><label for="gradientEndY">グラデーション終了 Y:</label> <input type="range" id="gradientEndY" min="0" max="400" value="400"></div></div><button id="downloadPng">PNGダウンロード</button><canvas id="fabricCanvas" width="400" height="400"></canvas><script>!function(){const e=new fabric.Canvas("fabricCanvas"),t=document.createElement("canvas");t.width=400,t.height=400;const n=t.getContext("2d"),a=document.getElementById("colorPicker"),d=document.getElementById("noiseMinSlider"),i=document.getElementById("noiseMaxSlider"),r=document.getElementById("gradientStartX"),o=document.getElementById("gradientStartY"),c=document.getElementById("gradientEndX"),u=document.getElementById("gradientEndY"),l=document.getElementById("downloadPng");function s(e,a,d){const i=n.createImageData(t.width,t.height),l=i.data,s=function(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}(e),m=parseInt(r.value),g=parseInt(o.value),p=parseInt(c.value),E=parseInt(u.value);for(let e=0;e<t.height;e++)for(let n=0;n<t.width;n++){const i=4*(e*t.width+n),r=p-m,o=E-g,c=a+((n-m)*r+(e-g)*o)/(r*r+o*o)*(d-a);100*Math.random()<c?(l[i]=s.r,l[i+1]=s.g,l[i+2]=s.b,l[i+3]=255):(l[i]=255,l[i+1]=255,l[i+2]=255,l[i+3]=0)}return i}function m(){const r=s(a.value,parseInt(d.value),parseInt(i.value));n.putImageData(r,0,0),e.clear(),fabric.Image.fromURL(t.toDataURL(),(function(t){e.add(t),e.renderAll()}))}a.addEventListener("input",m),d.addEventListener("input",m),i.addEventListener("input",m),r.addEventListener("input",m),o.addEventListener("input",m),c.addEventListener("input",m),u.addEventListener("input",m),l.addEventListener("click",(function(){const e=document.createElement("a");e.href=t.toDataURL("image/png"),e.download="noise_gradient_tone.png",document.body.appendChild(e),e.click(),document.body.removeChild(e)})),m()}()</script></body></html>