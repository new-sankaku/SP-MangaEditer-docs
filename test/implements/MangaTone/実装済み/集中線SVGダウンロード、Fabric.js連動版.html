<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>集中線ジェネレーター（Fabric.js版）</title><script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script><style>body{font-family:Arial,sans-serif;margin:0;padding:10px;display:flex;flex-direction:column;align-items:center;background-color:#f0f0f0}.controls{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;margin-bottom:10px;width:100%;max-width:600px}.control{display:flex;flex-direction:column;align-items:flex-start}label{margin-bottom:2px;font-size:.9em}.slider-container{display:flex;align-items:center;width:100%}input[type=range]{flex-grow:1;margin-right:5px}.value-display{min-width:35px;text-align:right;font-size:.9em}input[type=color]{width:40px;height:40px;padding:0;border:none}button{margin-top:10px;padding:10px 20px;font-size:1em;cursor:pointer}</style></head><body><canvas id="hiddenCanvas" style="display:none"></canvas><div class="controls"><div class="control"><label for="lineNum">線の数:</label><div class="slider-container"><input type="range" id="lineNum" min="50" max="500" value="200"> <span id="lineNumValue" class="value-display">200</span></div></div><div class="control"><label for="crMax">最大半径 (%):</label><div class="slider-container"><input type="range" id="crMax" min="1" max="100" value="40"> <span id="crMaxValue" class="value-display">40%</span></div></div><div class="control"><label for="crMin">最小半径 (%):</label><div class="slider-container"><input type="range" id="crMin" min="1" max="100" value="30"> <span id="crMinValue" class="value-display">30%</span></div></div><div class="control"><label for="centerX">中心 X (%):</label><div class="slider-container"><input type="range" id="centerX" min="0" max="100" value="50"> <span id="centerXValue" class="value-display">50%</span></div></div><div class="control"><label for="centerY">中心 Y (%):</label><div class="slider-container"><input type="range" id="centerY" min="0" max="100" value="50"> <span id="centerYValue" class="value-display">50%</span></div></div><div class="control"><label for="lineWidth">線の広がり:</label><div class="slider-container"><input type="range" id="lineWidth" min="1" max="50" value="30"> <span id="lineWidthValue" class="value-display">30</span></div></div><div class="control"><label for="lineColor">線の色:</label> <input type="color" id="lineColor" value="#000000"></div></div><button id="downloadSvg">SVGをダウンロード</button><canvas id="fabricCanvas" width="500" height="300"></canvas><script>var lines,focusLine=function(e,t,n,i,o,c,a,d){var s=e.getContext("2d"),r=[],u=function(e,t){return Math.floor(Math.random()*(e-t))+t},l=function(e,t,n){return Math.cos(Math.PI/180*e)*t+n},h=function(e,t,n){return Math.sin(Math.PI/180*e)*t+n},m=function(){this.initialize()};return m.prototype={initialize:function(){this.deg=u(360,0)},setPos:function(){this.moveDeg=this.deg+u(i,1)/10;var o=1+Math.max(Math.abs(t-e.width/2)/(e.width/2),Math.abs(n-e.height/2)/(e.height/2));this.endRadius=u(c,a)*o;var d=Math.max(e.width,e.height)*o;this.startPos={x:l(this.deg,d,t),y:h(this.deg,d,n)},this.movePos={x:l(this.moveDeg,d,t),y:h(this.moveDeg,d,n)},this.endPos={x:l(this.moveDeg,this.endRadius,t),y:h(this.moveDeg,this.endRadius,n)}},update:function(){this.setPos()},draw:function(){s.beginPath(),s.lineWidth=1,s.fillStyle=d,s.moveTo(this.startPos.x,this.startPos.y),s.lineTo(this.movePos.x,this.movePos.y),s.lineTo(this.endPos.x,this.endPos.y),s.fill(),s.closePath()},render:function(){this.update(),this.draw()}},function(e){r=[];for(var t=0;t<e;t++)r[r.length]=new m}(o),function(){var t=0,n=r.length;for(s.clearRect(0,0,e.width,e.height);t<n;t++)r[t].render()}(),r},cs=document.getElementById("hiddenCanvas"),conf={cx:cs.width/2,cy:cs.height/2,lineWidth:30,lineNum:200,crMax:40,crMin:30,color:"#000000"},fabricCanvas=new fabric.Canvas("fabricCanvas");function updateFocusLine(){conf.lineNum=parseInt(document.getElementById("lineNum").value),conf.crMax=parseInt(document.getElementById("crMax").value)/100*Math.min(cs.width,cs.height)/2,conf.crMin=parseInt(document.getElementById("crMin").value)/100*Math.min(cs.width,cs.height)/2,conf.cx=parseInt(document.getElementById("centerX").value)/100*cs.width,conf.cy=parseInt(document.getElementById("centerY").value)/100*cs.height,conf.lineWidth=parseInt(document.getElementById("lineWidth").value),conf.color=document.getElementById("lineColor").value,lines=focusLine(cs,conf.cx,conf.cy,conf.lineWidth,conf.lineNum,conf.crMax,conf.crMin,conf.color),document.getElementById("lineNumValue").textContent=conf.lineNum,document.getElementById("crMaxValue").textContent=document.getElementById("crMax").value+"%",document.getElementById("crMinValue").textContent=document.getElementById("crMin").value+"%",document.getElementById("centerXValue").textContent=document.getElementById("centerX").value+"%",document.getElementById("centerYValue").textContent=document.getElementById("centerY").value+"%",document.getElementById("lineWidthValue").textContent=conf.lineWidth,updateFabricCanvas()}function convertToSVG(){var e=`<svg xmlns="http://www.w3.org/2000/svg" width="${cs.width}" height="${cs.height}">`;return lines.forEach((function(t){e+=`<path d="M${t.startPos.x},${t.startPos.y} L${t.movePos.x},${t.movePos.y} L${t.endPos.x},${t.endPos.y} Z" fill="${conf.color}" />`})),e+="</svg>"}function downloadSVG(){var e=convertToSVG(),t=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),n=URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.download="focus_lines.svg",document.body.appendChild(i),i.click(),document.body.removeChild(i)}function updateFabricCanvas(){fabricCanvas.clear();var e=convertToSVG();fabric.loadSVGFromString(e,(function(e,t){var n=fabric.util.groupSVGElements(e,t);n.scaleToWidth(fabricCanvas.width),n.scaleToHeight(fabricCanvas.height),fabricCanvas.add(n),fabricCanvas.renderAll()}));var t=new fabric.Polygon([{x:50,y:50},{x:200,y:50},{x:200,y:150},{x:50,y:150}],{fill:"transparent",stroke:"black",strokeWidth:2,selectable:!0});fabricCanvas.add(t),fabricCanvas.renderAll(),t.on("selected",(function(){var e=t.height/t.width;cs.height=Math.round(cs.width*e),conf.cy=cs.height/2,updateFocusLine()}))}document.getElementById("lineNum").addEventListener("input",updateFocusLine),document.getElementById("crMax").addEventListener("input",updateFocusLine),document.getElementById("crMin").addEventListener("input",updateFocusLine),document.getElementById("centerX").addEventListener("input",updateFocusLine),document.getElementById("centerY").addEventListener("input",updateFocusLine),document.getElementById("lineWidth").addEventListener("input",updateFocusLine),document.getElementById("lineColor").addEventListener("input",updateFocusLine),document.getElementById("downloadSvg").addEventListener("click",downloadSVG),cs.width=500,cs.height=500,updateFocusLine()</script></body></html>