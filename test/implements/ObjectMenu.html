<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Fabric.js オブジェクト別メニューデモ</title><script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/i18next/21.6.16/i18next.min.js"></script><style>#fabricjs-canvas-container{position:relative;width:500px;height:500px;border:1px solid #ccc}#fabricjs-object-menu{position:absolute;display:none;background-color:rgba(255,255,255,.85);padding:2px;z-index:100;border-radius:4px;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;font-size:11px;user-select:none;display:flex;flex-direction:column;border:1px solid rgba(0,0,0,.1)}#fabricjs-object-menu button{margin:1px;cursor:pointer;padding:4px 8px;background-color:transparent;border:none;border-radius:2px;color:#333;transition:all .2s ease;font-size:11px;width:100%;text-align:left;white-space:nowrap}#fabricjs-object-menu button:hover{background-color:rgba(0,0,0,.05);color:#000}#fabricjs-object-menu button:active{background-color:rgba(0,0,0,.1)}#fabricjs-language-selector{position:absolute;top:10px;right:10px}</style></head><body><div id="fabricjs-canvas-container"><canvas id="fabricjs-canvas" width="500" height="500"></canvas></div><div id="fabricjs-object-menu"></div><select id="fabricjs-language-selector"><option value="en">English</option><option value="ja">日本語</option></select><script>const canvas=new fabric.Canvas("fabricjs-canvas"),objectMenu=document.getElementById("fabricjs-object-menu"),languageSelector=document.getElementById("fabricjs-language-selector");let lastClickType=null;function getTranslatedText(e){const t=i18next.t(e);return t!==e?t:""}function updateObjectMenuPosition(){const e=canvas.getActiveObject();if(!e)return;const t=e.getBoundingRect(!0,!0),n=canvas.getElement().getBoundingClientRect();let a=t.left+t.width+20,o=t.top;a+objectMenu.offsetWidth>n.right&&(a=t.left-20-objectMenu.offsetWidth),o+objectMenu.offsetHeight>n.bottom&&(o=n.bottom-objectMenu.offsetHeight),objectMenu.style.left=`${a}px`,objectMenu.style.top=`${o}px`}function showObjectMenu(e){const t=canvas.getActiveObject();if(!t)return;let n=["remove","duplicate","moveUp","moveDown"];t instanceof fabric.IText?n="right"===e?["edit","font"]:["remove","duplicate"]:t instanceof fabric.Polygon&&(n="right"===e?["addPoint","removePoint"]:["remove","duplicate"]);let a="";n.forEach((e=>{a+=`<button id="fabricjs-${e}-btn">${getTranslatedText(e)}</button>`})),objectMenu.innerHTML=a,objectMenu.style.display="flex",updateObjectMenuPosition(),lastClickType=e}i18next.init({lng:"en",resources:{en:{translation:{remove:"Remove",duplicate:"Duplicate",moveUp:"Move Up",moveDown:"Move Down",edit:"Edit Text",font:"Change Font",addPoint:"Add Point",removePoint:"Remove Point"}},ja:{translation:{remove:"削除",duplicate:"複製",moveUp:"前面へ",moveDown:"背面へ",edit:"テキスト編集",font:"フォント変更",addPoint:"ポイント追加",removePoint:"ポイント削除"}}}}),canvas.add(new fabric.Rect({left:100,top:100,width:50,height:50,fill:"red"})),canvas.add(new fabric.IText("テキスト",{left:200,top:200,fill:"green"})),canvas.add(new fabric.Polygon([{x:300,y:300},{x:350,y:300},{x:375,y:350},{x:325,y:375},{x:275,y:350}],{fill:"blue"})),canvas.on("selection:created",(()=>showObjectMenu("left"))),canvas.on("selection:updated",(()=>showObjectMenu("left"))),canvas.wrapperEl.addEventListener("contextmenu",(function(e){e.preventDefault();canvas.getPointer(e);const t=canvas.findTarget(e,!1);t&&(canvas.setActiveObject(t),showObjectMenu("right"))})),canvas.wrapperEl.addEventListener("mousedown",(function(e){if(0===e.button&&"right"===lastClickType){e.preventDefault();const t=canvas.findTarget(e,!1);t&&(canvas.setActiveObject(t),showObjectMenu("left"))}})),objectMenu.addEventListener("click",(function(e){const t=canvas.getActiveObject();if(!t)return;const n=e.target.id.replace("fabricjs-","").replace("-btn","");switch(console.log(`Executing action: ${n}`),n){case"remove":canvas.remove(t);break;case"duplicate":t.clone((function(e){e.set({left:e.left+10,top:e.top+10}),canvas.add(e)}));break;case"moveUp":canvas.bringForward(t);break;case"moveDown":canvas.sendBackwards(t);break;case"edit":t instanceof fabric.IText&&(t.enterEditing(),t.selectAll());break;case"font":t instanceof fabric.IText&&t.set("fontFamily","Arial"===t.fontFamily?"Times New Roman":"Arial");break;case"addPoint":if(t instanceof fabric.Polygon){let e=t.points,n={x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2};e.splice(1,0,n),t.set({points:e})}break;case"removePoint":if(t instanceof fabric.Polygon&&t.points.length>3){let e=t.points;e.pop(),t.set({points:e})}}canvas.renderAll(),objectMenu.style.display="none"})),canvas.on("selection:cleared",(function(){objectMenu.style.display="none"})),canvas.on("object:moving",updateObjectMenuPosition),canvas.on("object:scaling",updateObjectMenuPosition),canvas.on("object:rotating",updateObjectMenuPosition),canvas.on("after:render",updateObjectMenuPosition),languageSelector.addEventListener("change",(function(e){i18next.changeLanguage(e.target.value),"flex"===objectMenu.style.display&&showObjectMenu(lastClickType)}))</script></body></html>