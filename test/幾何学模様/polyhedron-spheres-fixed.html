<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>リアルタイム多面体球体 (修正版) - 2D Canvas</title><style>body{margin:0;overflow:hidden;background:#f0f0f0}#controls{position:absolute;top:10px;left:10px;background:rgba(255,255,255,.7);padding:10px}label{display:inline-block;width:120px}</style></head><body><div id="controls"><select id="polyhedronType"><option value="tetrahedron">正四面体</option><option value="cube">立方体</option><option value="octahedron">正八面体</option><option value="dodecahedron">正十二面体</option><option value="icosahedron">正二十面体</option><option value="sphere">球体</option><option value="stellatedDodecahedron">星型十二面体</option></select><div id="paramControls"></div></div><canvas id="canvas"></canvas><script>const canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");let lastX,lastY,rotationX=0,rotationY=0,isDragging=!1,currentParams={},currentPolyhedronType="tetrahedron";const polyhedrons={tetrahedron:{params:{subdivisions:{min:0,max:4,value:0,step:1}},vertices:[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],faces:[[0,1,2],[0,3,1],[0,2,3],[1,3,2]]},cube:{params:{subdivisions:{min:0,max:4,value:0,step:1}},vertices:[[-1,-1,-1],[1,-1,-1],[1,1,-1],[-1,1,-1],[-1,-1,1],[1,-1,1],[1,1,1],[-1,1,1]],faces:[[0,1,2,3],[4,5,6,7],[0,4,7,3],[1,5,6,2],[0,1,5,4],[3,2,6,7]]},octahedron:{params:{subdivisions:{min:0,max:4,value:0,step:1}},vertices:[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],faces:[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,4],[1,4,3],[1,3,5],[1,5,2]]},dodecahedron:{params:{subdivisions:{min:0,max:3,value:0,step:1}},vertices:[[0,.618,1.618],[0,-.618,1.618],[0,-.618,-1.618],[0,.618,-1.618],[1.618,0,.618],[1.618,0,-.618],[-1.618,0,-.618],[-1.618,0,.618],[.618,1.618,0],[-.618,1.618,0],[-.618,-1.618,0],[.618,-1.618,0],[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1]],faces:[[0,1,14,4,12],[0,12,8,9,16],[0,16,7,18,1],[1,18,10,11,14],[2,3,13,5,15],[2,15,11,10,19],[2,19,6,17,3],[3,17,9,8,13],[4,14,11,15,5],[5,13,8,12,4],[6,19,10,18,7],[6,7,16,9,17]]},icosahedron:{params:{subdivisions:{min:0,max:4,value:0,step:1}},vertices:[[0,1,1.618],[0,-1,1.618],[0,-1,-1.618],[0,1,-1.618],[1.618,0,1],[-1.618,0,1],[-1.618,0,-1],[1.618,0,-1],[1,1.618,0],[-1,1.618,0],[-1,-1.618,0],[1,-1.618,0]],faces:[[0,1,4],[0,4,8],[0,8,9],[0,9,5],[0,5,1],[1,5,10],[1,10,11],[1,11,4],[2,3,7],[2,7,11],[2,11,10],[2,10,6],[2,6,3],[3,6,9],[3,9,8],[3,8,7],[4,11,7],[4,7,8],[5,6,10],[5,9,6]]},sphere:{params:{segments:{min:4,max:32,value:16,step:1}},generate:e=>{const{segments:t}=e,n=[],a=[];for(let e=0;e<=t;e++){const s=e/t*Math.PI;for(let r=0;r<=t;r++){const o=r/t*2*Math.PI,i=Math.sin(s)*Math.cos(o),c=Math.cos(s),u=Math.sin(s)*Math.sin(o);if(n.push([i,c,u]),e<t&&r<t){const n=e*(t+1)+r,s=n+1,o=(e+1)*(t+1)+r,i=o+1;a.push([n,s,o]),a.push([s,i,o])}}}return{vertices:n,faces:a}}},stellatedDodecahedron:{params:{scale:{min:.1,max:2,value:1,step:.1}},generate:e=>{const{scale:t}=e,n=(1+Math.sqrt(5))/2;return{vertices:[[0,1,n],[0,-1,n],[0,-1,-n],[0,1,-n],[n,0,1],[-n,0,1],[-n,0,-1],[n,0,-1],[1,n,0],[-1,n,0],[-1,-n,0],[1,-n,0]].map((e=>e.map((e=>e*t)))),faces:[[0,1,4],[0,4,8],[0,8,9],[0,9,5],[0,5,1],[1,5,10],[1,10,11],[1,11,4],[2,3,7],[2,7,11],[2,11,10],[2,10,6],[2,6,3],[3,6,9],[3,9,8],[3,8,7],[4,11,7],[4,7,8],[5,6,10],[5,9,6]]}}}};function project(e,t,n){const a=.4*Math.min(canvas.width,canvas.height),s=e,r=t*Math.cos(rotationX)-n*Math.sin(rotationX),o=t*Math.sin(rotationX)+n*Math.cos(rotationX);e=s*Math.cos(rotationY)+o*Math.sin(rotationY),t=r;const i=a/(a+(n=-s*Math.sin(rotationY)+o*Math.cos(rotationY))+2);return[e*i*a+canvas.width/2,t*i*a+canvas.height/2]}function subdivide(e,t,n){if(0===n)return{vertices:e,faces:t};const a=[...e],s=[];function r(t,n){const[a,s,r]=e[t],[o,i,c]=e[n];return[(a+o)/2,(s+i)/2,(r+c)/2]}for(const e of t){const[t,n,o]=e,i=a.push(r(t,n))-1,c=a.push(r(n,o))-1,u=a.push(r(o,t))-1;s.push([t,i,u]),s.push([n,c,i]),s.push([o,u,c]),s.push([i,c,u])}return subdivide(a,s,n-1)}function normalize(e){return e.map((e=>{const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]}))}function draw(){ctx.clearRect(0,0,canvas.width,canvas.height),ctx.strokeStyle="rgba(0, 0, 0, 0.3)",ctx.fillStyle="rgba(0, 0, 0, 0.1)";let{vertices:e,faces:t}=polyhedrons[currentPolyhedronType];polyhedrons[currentPolyhedronType].generate?({vertices:e,faces:t}=polyhedrons[currentPolyhedronType].generate(currentParams)):currentParams.subdivisions>0&&(({vertices:e,faces:t}=subdivide(e,t,currentParams.subdivisions)),e=normalize(e));for(const n of t){ctx.beginPath();const[t,a]=project(...e[n[0]]);ctx.moveTo(t,a);for(let t=1;t<n.length;t++){const[a,s]=project(...e[n[t]]);ctx.lineTo(a,s)}ctx.closePath(),ctx.fill(),ctx.stroke()}requestAnimationFrame(draw)}function createControls(){const e=document.getElementById("paramControls");e.innerHTML="";const t=polyhedrons[currentPolyhedronType].params;Object.entries(t).forEach((([t,n])=>{const a=document.createElement("div");a.innerHTML=`\n            <label for="${t}">${t}:</label>\n            <input type="range" id="${t}" min="${n.min}" max="${n.max}" value="${n.value}" step="${n.step}">\n            <span>${n.value}</span>\n        `,e.appendChild(a);const s=a.querySelector("input"),r=a.querySelector("span");s.addEventListener("input",(()=>{currentParams[t]=Number(s.value),r.textContent=s.value})),currentParams[t]=n.value}))}function resizeCanvas(){canvas.width=window.innerWidth,canvas.height=window.innerHeight}document.getElementById("polyhedronType").addEventListener("change",(e=>{currentPolyhedronType=e.target.value,createControls()})),canvas.addEventListener("mousedown",(e=>{isDragging=!0,lastX=e.clientX,lastY=e.clientY})),canvas.addEventListener("mousemove",(e=>{if(!isDragging)return;const t=e.clientX-lastX,n=e.clientY-lastY;rotationY+=.005*t,rotationX+=.005*n,lastX=e.clientX,lastY=e.clientY})),canvas.addEventListener("mouseup",(()=>isDragging=!1)),canvas.addEventListener("mouseleave",(()=>isDragging=!1)),window.addEventListener("resize",resizeCanvas),resizeCanvas(),createControls(),draw()</script></body></html>