<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>球面パターン - Canvas API</title><style>body{margin:0;display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;background:#f0f0f0}#controls{margin-bottom:20px;display:flex;flex-wrap:wrap;justify-content:center}#controls>div{margin:0 10px}label{display:inline-block;width:150px}#patternType{margin-bottom:10px}</style></head><body><div id="controls"><div><label for="patternType">パターンタイプ:</label> <select id="patternType"><option value="sphericalSpiral">球面スパイラル</option><option value="fibonacciSphere">フィボナッチ球</option><option value="sphericalHarmonics">球面調和関数</option><option value="greatCircles">大円</option></select></div><div id="paramControls"></div><div><button id="redraw">再描画</button></div></div><canvas id="canvas" width="800" height="800"></canvas><script>const canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),redrawBtn=document.getElementById("redraw"),patternTypeSelect=document.getElementById("patternType"),paramControls=document.getElementById("paramControls");let currentParams={};function projectToSphere(t,e,a){return{x:a*Math.sin(e)*Math.cos(t),y:a*Math.sin(e)*Math.sin(t),z:a*Math.cos(e)}}function projectTo2D(t,e,a,n){const r=n/(n+a);return{x:r*t+canvas.width/2,y:r*e+canvas.height/2}}const patterns={sphericalSpiral:{params:{turns:{min:1,max:50,value:20,step:1,label:"回転数"},points:{min:100,max:5e3,value:1e3,step:100,label:"点の数"}},draw:t=>{const{turns:e,points:a}=t,n=.45*Math.min(canvas.width,canvas.height);ctx.beginPath();for(let t=0;t<a;t++){const r=t/(a-1),s=2*Math.PI*e*r,c=Math.acos(1-2*r),{x:o,y:l,z:i}=projectToSphere(s,c,n),{x:h,y:p}=projectTo2D(o,l,i,n);0===t?ctx.moveTo(h,p):ctx.lineTo(h,p)}ctx.stroke()}},fibonacciSphere:{params:{points:{min:10,max:2e3,value:500,step:10,label:"点の数"},size:{min:1,max:10,value:3,step:1,label:"点のサイズ"}},draw:t=>{const{points:e,size:a}=t,n=.45*Math.min(canvas.width,canvas.height),r=(1+Math.sqrt(5))/2;for(let t=0;t<e;t++){const s=2*Math.PI*t/r,c=Math.acos(1-2*(t+.5)/e),{x:o,y:l,z:i}=projectToSphere(s,c,n),{x:h,y:p}=projectTo2D(o,l,i,n);ctx.beginPath(),ctx.arc(h,p,a,0,2*Math.PI),ctx.fill()}}},sphericalHarmonics:{params:{l:{min:0,max:5,value:3,step:1,label:"次数 (l)"},m:{min:0,max:5,value:2,step:1,label:"位数 (m)"},resolution:{min:10,max:100,value:50,step:5,label:"解像度"}},draw:t=>{const{l:e,m:a,resolution:n}=t,r=.45*Math.min(canvas.width,canvas.height);for(let t=0;t<=n;t++)for(let s=0;s<=n;s++){const c=t/n*Math.PI*2,o=s/n*Math.PI,l=Math.abs(sphericalHarmonic(e,a,c,o)),{x:i,y:h,z:p}=projectToSphere(c,o,r*(1+.3*l)),{x:m,y:M}=projectTo2D(i,h,p,r);ctx.fillStyle=`hsl(${360*l}, 70%, 50%)`,ctx.fillRect(m,M,2,2)}}},greatCircles:{params:{circles:{min:1,max:20,value:5,step:1,label:"円の数"},points:{min:100,max:1e3,value:500,step:50,label:"点の数/円"}},draw:t=>{const{circles:e,points:a}=t,n=.45*Math.min(canvas.width,canvas.height);for(let t=0;t<e;t++){const t=Math.random()*Math.PI*2,e=Math.random()*Math.PI;ctx.beginPath();for(let r=0;r<=a;r++){const s=r/a*Math.PI*2,c=n*(Math.cos(s)*Math.cos(t)-Math.sin(s)*Math.sin(t)*Math.cos(e)),o=n*(Math.cos(s)*Math.sin(t)+Math.sin(s)*Math.cos(t)*Math.cos(e)),l=n*Math.sin(s)*Math.sin(e),{x:i,y:h}=projectTo2D(c,o,l,n);0===r?ctx.moveTo(i,h):ctx.lineTo(i,h)}ctx.stroke()}}}};function sphericalHarmonic(t,e,a,n){if(0===t)return.5*Math.sqrt(1/Math.PI);if(1===t){if(0===e)return.5*Math.sqrt(3/Math.PI)*Math.cos(n);if(1===Math.abs(e))return.5*Math.sqrt(3/(2*Math.PI))*Math.sin(n)*(1===e?Math.cos(a):Math.sin(a))}return Math.cos(t*n)*Math.cos(e*a)}function createControls(t){paramControls.innerHTML="",Object.entries(patterns[t].params).forEach((([t,e])=>{const a=document.createElement("div");a.innerHTML=`\n                    <label for="${t}">${e.label}:</label>\n                    <input type="range" id="${t}" min="${e.min}" max="${e.max}" value="${e.value}" step="${e.step}">\n                    <span id="${t}Value">${e.value}</span>\n                `,paramControls.appendChild(a);const n=a.querySelector(`#${t}`),r=a.querySelector(`#${t}Value`);n.addEventListener("input",(()=>{currentParams[t]=parseInt(n.value),r.textContent=n.value,redraw()})),currentParams[t]=e.value}))}function redraw(){ctx.clearRect(0,0,canvas.width,canvas.height),ctx.strokeStyle=`hsl(${360*Math.random()}, 70%, 50%)`,ctx.fillStyle=ctx.strokeStyle,ctx.lineWidth=1;const t=patternTypeSelect.value;patterns[t].draw(currentParams)}patternTypeSelect.addEventListener("change",(()=>{createControls(patternTypeSelect.value),redraw()})),redrawBtn.addEventListener("click",redraw),createControls(patternTypeSelect.value),redraw()</script></body></html>